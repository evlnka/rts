# intro

- Потоки POSIX (`pthread_create`, `pthread_join`) позволяют параллелизм на уровне процесса.
- Синхронизация: мьютексы (взаимное исключение), условные переменные (`pthread_cond_wait/signal`).
- Правило: всегда защищайте разделяемое состояние мьютексом; ожидание событий — только под мьютексом, цикл `while (!cond) wait(...)`.
- Безопасное завершение: используйте флаг завершения и будите ожидающие потоки.

## Атрибуты потоков и приоритеты

- `pthread_attr_t`: можно задавать политику планирования (`SCHED_OTHER`, `SCHED_FIFO`, `SCHED_RR`) и приоритет (`sched_param`). На Linux повышение приоритета реального времени требует прав (root/капабилити).
- Используйте явное наследование планирования: `pthread_attr_setinheritsched(attr, PTHREAD_EXPLICIT_SCHED)`.

## Условные переменные: шаблон использования

1. Захватить мьютекс.
2. Пока условие не выполнено — `pthread_cond_wait(&cond, &mutex)`.
3. После пробуждения — всегда перепроверять условие в `while` из‑за возможных ложных пробуждений.
4. Освободить мьютекс, при необходимости — `pthread_cond_signal/broadcast`.

Частые ошибки:

- Ожидание на `pthread_cond_wait` без захвата соответствующего мьютекса.
- Использование `if` вместо `while` вокруг `pthread_cond_wait`.
- Доступ к разделяемому состоянию без мьютекса.

Практика:

- `hello.c` — базовый ввод/вывод, аргументы командной строки

Компилируем и запускаем: 
```bash
c -Wall -Wextra -O2 -pthread src/intro/hello.c  -o bin/hello
./bin/hello hello world
```
Вместо hello world может быть любой аргумент

[![hello.png](https://i.postimg.cc/8kb06T9p/hello.png)](https://postimg.cc/RqNdrxvy)

- `intro.c` — 3 потока: считывание состояния, вывод изменений, UI.

У нас есть три потока:
- sense - сбор данных от пользователя
- stateOutput - обработка изменений состояния
- userInterface - визуализация текущего состояния
И следующие состояния системы:
- N/n - "Не готово" 
- R/r - "Готово" 
- D/d - "Режим работы"\
\
Посмотрим как работают потоки\
\
Компилируем и запускаем: 
```bash
c -Wall -Wextra -O2 -pthread src/intro/intro.c  -o bin/intro
./bin/intro 
```
[![intro.png](https://i.postimg.cc/GpQyjSCD/intro.png)](https://postimg.cc/8F7cp4sk)

- Строка 1: главный поток выводит Hello World! И завершает свою активную работу
- Строки 2-4: Это поток userInterface который выводит текущее состояние в данном случае n — не готово
- Строка 5: Ввод пользователем на какое состояние мы должны перейти
- Строка 6: Поток stateOutput получил сигнал и поменял состояние и визуализацию на состояние R\
 И далее происходит тоже самое меняем на состояние d и n b и видим другую визуализацию каждого состояния